<!DOCTYPE html>
<html>
<head>
  <title>ghostgame</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    #lock, #chatbox {
      width: 100%;
      min-height: 100vh;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: #000;
    }

    h2 {
      margin-bottom: 20px;
      font-size: 26px;
    }

    input, button {
      width: 100%;
      max-width: 400px;
      padding: 14px;
      margin: 8px 0;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background: #111;
      color: white;
      box-sizing: border-box;
    }

    button {
      background: #ff0055;
    }

    #chat {
      width: 100%;
      max-width: 400px;
      height: 55vh;
      overflow-y: auto;
      border: 1px solid #222;
      padding: 10px;
      margin-bottom: 8px;
      background: #000;
    }

    #typing {
      width: 100%;
      max-width: 400px;
      font-size: 12px;
      color: #777;
      height: 18px;
      margin-bottom: 5px;
    }

    @media (min-width: 600px) {
      #chat {
        height: 300px;
      }
    }
  </style>
</head>
<body>

<div id="lock">
  <h2>ðŸ‘» ghostroom</h2>
  <input id="pass" type="password" placeholder="Enter password..." />
  <button onclick="unlock()">Unlock</button>
</div>

<div id="chatbox" style="display:none;">
  <h2>ðŸ‘» ghostroom</h2>
  <div id="chat"></div>
  <div id="typing"></div>
  <input id="msg" placeholder="Type your message..." oninput="sendTyping()" />
  <button onclick="send()">Send</button>
</div>

<script>
const SECRET = "foreverus";
const DELETE_TIME = 60000; // 60 seconds

let room = window.location.search || "?nightride";
let channel = new BroadcastChannel(room);
let typingTimeout;

function unlock() {
  let p = document.getElementById("pass").value;
  if (p === SECRET) {
    document.getElementById("lock").style.display = "none";
    document.getElementById("chatbox").style.display = "flex";
  } else {
    alert("âŒ Wrong Password");
  }
}

channel.onmessage = (e) => {
  let data = e.data;

  if (data.type === "typing") {
    showTyping();
    return;
  }

  let chat = document.getElementById("chat");
  let msgDiv = document.createElement("div");
  msgDiv.innerText = "ðŸ’¬ " + data.text;
  chat.appendChild(msgDiv);
  chat.scrollTop = chat.scrollHeight;

  setTimeout(() => {
    msgDiv.remove();
  }, DELETE_TIME);
};

function send() {
  let msg = document.getElementById("msg");
  if (msg.value.trim() !== "") {
    channel.postMessage({ type: "msg", text: msg.value });
    msg.value = "";
  }
}

function sendTyping() {
  channel.postMessage({ type: "typing" });
}

function showTyping() {
  let typing = document.getElementById("typing");
  typing.innerText = "Someone is typing...";
  clearTimeout(typingTimeout);
  typingTimeout = setTimeout(() => {
    typing.innerText = "";
  }, 1000);
}
</script>

</body>
</html>
